/**
 * PDF Helper Functions for EEA Reports
 * Common utilities for generating branded PDF reports
 */

/**
 * Add CVSift header to PDF
 * @param {jsPDF} doc - jsPDF document
 * @param {string} title - Report title
 * @param {string} subtitle - Report subtitle (optional)
 * @param {string} disclaimer - Disclaimer text (optional)
 * @returns {number} - Y position after header
 */
export function addReportHeader(doc, title, subtitle = null, disclaimer = null) {
  const pageWidth = doc.internal.pageSize.width;
  let yPosition = 20;

  // Title
  doc.setFontSize(18);
  doc.setFont('helvetica', 'bold');
  doc.text(title, pageWidth / 2, yPosition, { align: 'center' });
  yPosition += 8;

  // Subtitle
  if (subtitle) {
    doc.setFontSize(10);
    doc.setFont('helvetica', 'italic');
    doc.text(subtitle, pageWidth / 2, yPosition, { align: 'center' });
    yPosition += 8;
  }

  // Date
  doc.setFontSize(9);
  doc.setFont('helvetica', 'normal');
  doc.text(`Report Date: ${new Date().toLocaleDateString()}`, pageWidth / 2, yPosition, { align: 'center' });
  yPosition += 3;

  // Disclaimer
  if (disclaimer) {
    doc.setFontSize(8);
    doc.setFont('helvetica', 'italic');
    doc.setTextColor(100, 100, 100);
    doc.text(disclaimer, pageWidth / 2, yPosition, { align: 'center', maxWidth: pageWidth - 40 });
    doc.setTextColor(0, 0, 0);
    yPosition += 12;
  } else {
    yPosition += 10;
  }

  return yPosition;
}

/**
 * Add page footer with CVSift branding
 * @param {jsPDF} doc - jsPDF document
 */
export function addPageFooters(doc) {
  const totalPages = doc.internal.getNumberOfPages();
  const pageWidth = doc.internal.pageSize.width;
  const pageHeight = doc.internal.pageSize.height;

  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i);
    doc.setFontSize(8);
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(100, 100, 100);
    doc.text(
      `Generated by CVSift | www.cvsift.com | Page ${i} of ${totalPages}`,
      pageWidth / 2,
      pageHeight - 10,
      { align: 'center' }
    );
    doc.setTextColor(0, 0, 0);
  }
}

/**
 * Format company information section
 * @param {jsPDF} doc - jsPDF document
 * @param {Object} company - Company data
 * @param {number} yPosition - Starting Y position
 * @returns {number} - Y position after section
 */
export function addCompanyInfo(doc, company, yPosition) {
  doc.setFontSize(12);
  doc.setFont('helvetica', 'bold');
  doc.text('Company Information', 14, yPosition);
  yPosition += 7;

  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text(`Company Name: ${company.name}`, 14, yPosition);
  yPosition += 5;
  doc.text(`Economic Sector: ${company.sector.replace(/_/g, ' ')}`, 14, yPosition);
  yPosition += 5;
  doc.text(`EE Reference Number: ${company.eeReferenceNumber || 'N/A'}`, 14, yPosition);
  yPosition += 5;

  const reportingFrom = company.eeReportingPeriod?.from?.toLocaleDateString() || 'N/A';
  const reportingTo = company.eeReportingPeriod?.to?.toLocaleDateString() || 'N/A';
  doc.text(`Reporting Period: ${reportingFrom} to ${reportingTo}`, 14, yPosition);
  yPosition += 10;

  return yPosition;
}

/**
 * Check if new page is needed
 * @param {jsPDF} doc - jsPDF document
 * @param {number} yPosition - Current Y position
 * @param {number} requiredSpace - Space needed for next content
 * @returns {number} - Updated Y position
 */
export function checkPageBreak(doc, yPosition, requiredSpace = 50) {
  if (yPosition > 250) {
    doc.addPage();
    return 20;
  }
  return yPosition;
}
